<!DOCTYPE html>
<html>
  <head>
    <title>Reticulum JS Client</title>
  </head>
  <body>
    <h1>Reticulum JS Reference Implementation</h1>

    <script type="module">
      import { parsePacket, generateIdentity, createAnnouncePacket, createDataPacket, decrypt, TYPE_ANNOUNCE, TYPE_DATA, bytesToHex, hexToBytes } from './reticulum.js'

      const testPackets = [
        '7e0000caafffe2fa9d5c6110ce08b175d3ec5400589422d01e94c975dfd983db428129ddb10d6776a178037d5db9f04267187fc21a75b36d2718af444e6ff368eb02fdd2e1446ae88e99938231896915595e704d89cea024604732f91133f431a0aeaf228449873fad9083344cf897afdc865467b6e5e52e3882de7b446aba40f23fcd22df7c9b6238b526f93874a9dd0bb49a951c476710018089a6d52ae60f59884578e9cfff911b38b916f2a3dc6f1b98a2936d5efbfc9c193e3e2f21a8fe17622a1d2f258937195ff45bb639ef3b22b32ea4ce96ead643d51fb2df7414102c2f93a0537e',
        '7e2100aecf3fe64b5b394c7d5d996a5ac49835b100a734c9c1d320ea4332438072d6dc9f6c7d5d9b07c75b5c6364434c33ca1066303c6a8229913c0776977fb9c9c5f5e027737d5e888c57066caa4a8e11b9faeae78e256ec60bc318e2c0f0d908e4b8cd4ffe0068c7c25058b78eed347591ee96e07798e06bf0f503985a9f220ea1877d5d40e8661325f9027962392c92847a8798caa301f6b3433bd59044d28bd8690cdbb58248d6ebafb387fe5c45a5d42da81727102fddd6c14b6bc146e6477f075a83a2658baad34c0c92c40e416e6f6e796d6f75732050656572c07e'
      ]

      console.log('=== Testing Packet Parsing ===')
      const parsedPackets = testPackets
        .map((hex) => {
          try {
            const packet = parsePacket(hex)
            console.log('Parsed packet:', packet)
            return packet
          } catch (error) {
            console.error('Failed to parse packet:', hex, error)
            return null
          }
        })
        .filter((p) => p !== null)

      console.log('\n=== Testing Identity Generation ===')
      const identity = await generateIdentity()
      console.log('Generated identity:', identity)

      console.log('\n=== Testing Announce Packet Creation ===')
      const announcePacket = await createAnnouncePacket(identity)
      console.log('Created announce packet:', announcePacket)

      const parsedAnnounce = parsePacket(announcePacket.packetHex)
      console.log('Parsed our announce packet:', parsedAnnounce)

      console.log('\n=== Testing Remote Identity & Data Packets ===')
      console.log('Found remote identity in announce packet:', parsedAnnounce)
      const message = new TextEncoder().encode('Hello from JS client!')
      
      const unencryptedPacket = await createDataPacket(identity, parsedAnnounce.identity, message, false)
      console.log('Created unencrypted data packet:', unencryptedPacket)
      
      const encryptedPacket = await createDataPacket(identity, parsedAnnounce.identity, message, true)
      console.log('Created encrypted data packet:', encryptedPacket)
    </script>
  </body>
</html>
